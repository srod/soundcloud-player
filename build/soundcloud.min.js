!function(a,b){"use strict";if("undefined"!=typeof exports){module.exports=b();var c=require("jquery");b(a,c)}else"function"==typeof define&&define.amd?define(["jquery"],function(c){return b(a,c)}):a.soundCloudPlayer=b(a,a.jQuery||a.$)}(this,function(a,b){"use strict";return function(a,b){var c="http://api.soundcloud.com/resolve?url=https://soundcloud.com/{username}/sets/{playlist}&format=json&consumer_key={consumerKey}&callback=?",d="data:image/gif;base64,R0lGODlhAQABAIAAAP///wAAACH5BAEAAAAALAAAAAABAAEAAAICRAEAOw==",e=!1,f={},g=0,h=function(a){return e&&console.log("soundCloudPlayer.addPlayer",a),a.id="player-"+g,m.domExtend(),m.getTracks(a,function(b,c){if(e&&(console.log("soundCloudPlayer.scp:err",b),console.log("soundCloudPlayer.scp:json",c)),b)throw new Error("Error on loading playlist : "+b);if(0===c.tracks.length)throw new Error("No tracks in your playlist");g++,f[a.id]=new i(a,c)}),a.id},i=function(a,b){e&&console.log("soundCloudPlayer.scp",a),this.player=new j(this,a,b)},j=function(a,b,c){this.nativeHTML5=new k(this),this.flash=new l(this),this.parent=a,this.create(b,c)};j.prototype={parent:null,options:{allowFullscreen:!0,showSoundCloudLogo:!1,showProgressIndicator:!0},tracks:[],audioHTML5:!1,isFullscreen:!1,audio:null,$body:b(),$audioFlash:b(),$container:b(),$title:b(),$picture:b(),$timeLine:b(),$progressBar:b(),$progressBarText:b(),$play:b(),$prev:b(),$next:b(),$shuffle:b(),$fullScreen:b(),$playerFullScreen:b(),action:null,type:"",oldTrack:0,currentTrack:0,status:"closed"},j.prototype.actions={PLAYING:"playing",PAUSED:"paused"},j.prototype.create=function(a,c){e&&console.log("soundCloudPlayer.player.create");var d=this;if(this.$body=b("body"),this.options=b.extend(this.options,a),this.tracks=c.tracks,this.id=a.id,this.audioHTML5=this.testMP3(),this.buildHTML(),this.isFullscreen=this.testFullscreen(),this.bind(),this.audioHTML5){this.type="nativeHTML5",this.audio=document.createElement("audio"),this.options.showProgressIndicator&&b(this.audio).on("timeupdate",function(){d.progressBar(this.currentTime,this.duration)}),b(this.audio).on("ended",function(){d.next()});var f=this.$picture.parent();b(this.audio).on("play",function(){f.addClass("loading")}),b(this.audio).on("pause",function(){f.removeClass("loading")}),b(this.audio).on("playing",function(){f.removeClass("loading")}),this.setNewTrack(this.currentTrack),this.$body.append(this.audio),e&&console.log("soundCloudPlayer.player.audio",this.audio)}else{this.type="flash";var g=document.createElement("div");this.$audioFlash=b(g),this.$audioFlash.prop("id","jplayer-"+this.id),this.$body.append(this.$audioFlash),m.handleJplayer(this.options.jPlayer,function(){d.$audioFlash.jPlayer({ready:function(){d.$audioFlash.on(b.jPlayer.event.timeupdate,function(a){d.progressBar(a.jPlayer.status.currentTime,a.jPlayer.status.duration)}),d.$audioFlash.on(b.jPlayer.event.ended,function(){d.next()}),d.setNewTrack(d.currentTrack)},swfPath:a.swfPath||"/swf/"})})}},j.prototype.buildHTML=function(){var a='<div id="'+this.id+'" class="scp"><div class="scp-picture"><img src="" width="100" height="100" class=""></div><div class="scp-content"><p class="scp-content-title"></p><div class="scp-content-commands"><a href="#" class="scp-prev">prev</a><a href="#" class="scp-play">play</a><a href="#" class="scp-next">next</a><a href="#" class="scp-shuffle">shuffle</a></div>';if(this.options.showProgressIndicator&&(a+='<span class="scp-content-timeline"><span class="scp-content-timeline-bar"></span><span class="scp-content-timeline-text"></span></span>'),this.options.allowFullscreen&&(a+='<a href="#" class="scp-fullscreen">fullscreen</a>'),this.options.showSoundCloudLogo&&(a+='<a class="scp-content-logo" href="#" title="Listen on SoundCloud" target="_blank">SoundCloud.com</a>'),a+="</div></div>",this.$container=b(a),this.$body.append(this.$container),this.options.allowFullscreen){var c=b("#player-fullscreen");c.length?this.$playerFullScreen=c:(this.$body.append('<div id="player-fullscreen"><div class="player-fullscreen-inner"><p class="player-fullscreen-title"></p><img src="'+d+'" class="player-fullscreen-picture"><p class="player-fullscreen-commands"><a href="#" class="player-fullscreen-prev">Prev</a><a href="#" class="player-fullscreen-next">Next</a></p><a href="#" class="player-fullscreen-close">Close</a></div></div>'),this.$playerFullScreen=b("#player-fullscreen"))}},j.prototype.testMP3=function(){var a=document.createElement("audio"),b=!!a.canPlayType&&""!==a.canPlayType("audio/mpeg");return e&&console.log("soundCloudPlayer.player.testMP3",b),b},j.prototype.testFullscreen=function(){return e&&console.log("soundCloudPlayer.player.testFullscreen"),this.options.allowFullscreen?!!(this.$body[0].requestFullScreen||this.$body[0].webkitRequestFullScreen||this.$body[0].mozRequestFullScreen||this.$body[0].msRequestFullScreen||this.$body[0].oRequestFullScreen):!1},j.prototype.bind=function(){var a=this;e&&console.log("soundCloudPlayer.player.bind",this.$container),this.$title=this.$container.find(".scp-content-title"),this.$picture=this.$container.find(".scp-picture img"),this.$timeLine=this.$container.find(".scp-content-timeline"),this.$progressBar=this.$container.find(".scp-content-timeline-bar"),this.$progressBarText=this.$container.find(".scp-content-timeline-text"),this.$logo=this.$container.find(".scp-content-logo"),this.$play=this.$container.find(".scp-play"),this.$prev=this.$container.find(".scp-prev"),this.$next=this.$container.find(".scp-next"),this.$shuffle=this.$container.find(".scp-shuffle"),this.$fullScreen=this.$container.find(".scp-fullscreen"),this.$play.on("click",function(b){b.preventDefault(),a.toggle()}),this.$prev.on("click",function(b){b.preventDefault(),a.prev()}),this.$next.on("click",function(b){b.preventDefault(),a.next()}),this.$shuffle.on("click",function(b){b.preventDefault(),a.shuffle()}),this.$fullScreen.on("click",function(b){b.preventDefault(),a.fullscreen()}),this.$timeLine.on("click",function(b){b.preventDefault();var c=jQuery(this).outerWidth(),d=jQuery(this).offset().left,e=b.pageX,f=a.getDuration()*(e-d)/c;a.setCurrentTime(f)}),this.options.allowFullscreen&&(!function(){var b,c;b=document,c=b.webkitCancelFullScreen?"webkitfullscreenchange":b.mozCancelFullScreen?"mozfullscreenchange":"fullscreenchange",jQuery(document).on(c,function(b){a.fullscreenExit(b)})}(),this.$playerFullScreen.find(".player-fullscreen-prev").on("click",function(b){b.preventDefault(),a.prev()}),this.$playerFullScreen.find(".player-fullscreen-next").on("click",function(b){b.preventDefault(),a.next()}),this.$playerFullScreen.find(".player-fullscreen-playpause").on("click",function(b){b.preventDefault(),a.toggle()}),this.$playerFullScreen.find(".player-fullscreen-close").on("click",function(b){b.preventDefault(),a.exitFullscreen()}))},j.prototype.loadPlaylist=function(a,b){e&&console.log("soundCloudPlayer.player.loadPlaylist",a);var c=this;this.options.playlist=a,m.getTracks(this.options,function(a,d){if(e&&(console.log("soundCloudPlayer.scp:err",a),console.log("soundCloudPlayer.scp:json",d)),a)throw new Error("Error on loading playlist : "+a);if(0===d.tracks.length)throw new Error("No tracks in your playlist");return c.tracks=d.tracks,c.oldTrack=c.currentTrack=0,c.setNewTrack(c.currentTrack,!1),b?b():!0})},j.prototype.setCurrentTime=function(a){return e&&console.log("soundCloudPlayer.player.setCurrentTime",a),this[this.type].setCurrentTime(a)},j.prototype.getDuration=function(){return e&&console.log("soundCloudPlayer.player.getDuration"),this[this.type].getDuration()},j.prototype.setSound=function(a){return e&&console.log("soundCloudPlayer.player.setSound",a),this[this.type].setSound(a)},j.prototype.play=function(a,b,c){e&&console.log("soundCloudPlayer.player.play",b);var d=this,f=function(){return"undefined"!=typeof b&&null!==b&&d.currentTrack!==b&&(d.currentTrack=b,d.setNewTrack(d.currentTrack,!1)),d.action=d.actions.PLAYING,d.$play.addClass("scp-pause"),d.$playerFullScreen.find(".player-fullscreen-playpause").removeClass("player-fullscreen-play player-fullscreen-pause").addClass("player-fullscreen-pause"),d[d.type].play()};c&&this.options.playlist!==c?this.loadPlaylist(c,function(){f()}):f()},j.prototype.pause=function(){return e&&console.log("soundCloudPlayer.player.pause"),this.action=this.actions.PAUSED,this.$play.removeClass("scp-pause"),this.$playerFullScreen.find(".player-fullscreen-playpause").removeClass("player-fullscreen-play player-fullscreen-pause").addClass("player-fullscreen-play"),this[this.type].pause()},j.prototype.toggle=function(a,b){e&&console.log("soundCloudPlayer.player.toggle",b),this.action===this.actions.PAUSED||a&&this.currentTrack!==a||b&&this.options.playlist!==b?this.play(!1,a,b):this.action===this.actions.PLAYING&&this.pause()},j.prototype.next=function(){e&&console.log("soundCloudPlayer.player.next"),this.currentTrack=this.currentTrack+1,this.currentTrack>=this.tracks.length&&(this.currentTrack=0),this.setNewTrack(this.currentTrack,!0)},j.prototype.prev=function(){e&&console.log("soundCloudPlayer.player.prev"),this.currentTrack=this.currentTrack-1,this.currentTrack<0&&(this.currentTrack=this.tracks.length-1),this.setNewTrack(this.currentTrack,!0)},j.prototype.setNewTrack=function(a,c){e&&console.log("soundCloudPlayer.player.setNewTrack",a,c);var d=this;this.pause(),this.setSound(a);var f=0,g=["-t500x500","-crop","-t300x300"],h=function(a,c){e&&console.log("soundCloudPlayer.player.setNewTrack.checkPicture",a),f++;var d=new Image;b(d).on("load error",function(b){return c(b.type,a)}),d.src=a},i=d.tracks[a].title;i&&(d.$title.html(i),this.options.allowFullscreen&&this.$playerFullScreen.find(".player-fullscreen-title").html(i));var j,k=this.tracks[a].artwork_url;if(k){d.setNoPicture(!1),d.$picture.prop("src",k);var l=function(a){d.$playerFullScreen.find(".player-fullscreen-picture").prop("src",a)},m=function(a,b){if("load"===a)l(b);else if(f<g.length){var c=k.replace("-large",g[f]);h(c,m)}else l(k)};if(d.options.allowFullscreen){var n=k.replace("-large",g[f]);h(n,m)}}else j=this.tracks[a].user.avatar_url,j?(this.setNoPicture(!1),this.$picture.prop("src",j),this.options.allowFullscreen&&this.$playerFullScreen.find(".player-fullscreen-picture").prop("src",j)):this.setNoPicture(!0);var o=this.tracks[a].permalink_url;o&&this.$logo.prop("href",o),c&&this.play(!0)},j.prototype.setNoPicture=function(a){e&&console.log("soundCloudPlayer.player.setNoPicture",a),a?(this.$container.addClass("scp-no-picture"),this.$picture.prop("src",d)):this.$container.removeClass("scp-no-picture")},j.prototype.shuffle=function(){e&&console.log("soundCloudPlayer.player.shuffle");var a=Math.random2(0,this.tracks.length-1);return a===this.currentTrack?this.shuffle():(this.oldTrack=this.currentTrack,this.currentTrack=a,void this.setNewTrack(a,!0))},j.prototype.fullscreen=function(){e&&console.log("soundCloudPlayer.player.fullscreen"),this.isFullscreen?(this.$playerFullScreen.show(),this.enterFullscreen.call(this.$playerFullScreen[0])):this.$playerFullScreen.fadeIn()},j.prototype.fullscreenExit=function(a){e&&console.log("soundCloudPlayer.player.fullscreenExit",a);var b=function(){return document.webkitIsFullScreen||document.mozFullScreen||document.fullScreen};b()||this.$playerFullScreen.hide()},j.prototype.enterFullscreen=function(){e&&console.log("soundCloudPlayer.player.enterFullscreen"),this.requestFullScreen?this.requestFullScreen():this.webkitRequestFullScreen?this.webkitRequestFullScreen():this.mozRequestFullScreen&&this.mozRequestFullScreen()},j.prototype.exitFullscreen=function(){e&&console.log("soundCloudPlayer.player.exitFullscreen"),this.isFullscreen?document.cancelFullScreen?document.cancelFullScreen():document.webkitCancelFullScreen?document.webkitCancelFullScreen():document.mozCancelFullScreen&&document.mozCancelFullScreen():this.$playerFullScreen.fadeOut()},j.prototype.progressBar=function(a,b){if(e&&console.log("soundCloudPlayer.player.progressBar"),!this.options.showProgressIndicator)return!1;var c=m.formatSecondsAsTime(Math.floor(a));this.$progressBar.width(100*a/b+"%"),this.$progressBarText.html(c)};var k=function(a){this.parent=a};k.prototype={parent:null},k.prototype.play=function(){return e&&console.log("soundCloudPlayer.nativeHTML5.play"),this.parent.audio.play()},k.prototype.pause=function(){return e&&console.log("soundCloudPlayer.nativeHTML5.pause"),this.parent.audio.pause()},k.prototype.setSound=function(a){e&&console.log("soundCloudPlayer.nativeHTML5.setSound",a),b(this.parent.audio).prop("src",this.parent.tracks[this.parent.currentTrack].stream_url+"?client_id="+this.parent.options.consumerKey)},k.prototype.setCurrentTime=function(a){e&&console.log("soundCloudPlayer.nativeHTML5.setCurrentTime",a),this.parent.audio.currentTime=a},k.prototype.getDuration=function(){return e&&console.log("soundCloudPlayer.nativeHTML5.getDuration"),this.parent.audio.duration};var l=function(a){this.parent=a};l.prototype={parent:null},l.prototype.play=function(){e&&console.log("soundCloudPlayer.flash.play"),this.parent.$audioFlash.jPlayer("play")},l.prototype.pause=function(){e&&console.log("soundCloudPlayer.flash.pause"),this.parent.$audioFlash.jPlayer("pause")},l.prototype.setSound=function(a){e&&console.log("soundCloudPlayer.flash.setSound",a),this.parent.$audioFlash.jPlayer("setMedia",{mp3:this.parent.tracks[this.parent.currentTrack].stream_url+"?client_id="+this.parent.options.consumerKey})},l.prototype.setCurrentTime=function(a){e&&console.log("soundCloudPlayer.flash.setCurrentTime",a),this.parent.$audioFlash.jPlayer("play",a)},l.prototype.getDuration=function(){return e&&console.log("soundCloudPlayer.flash.getDuration"),this.parent.$audioFlash.data("jPlayer").status.duration};var m={loadScript:function(a,b){e&&console.log("soundCloudPlayer.utils.loadScript",a);var c=!1,d=document.createElement("script");d.src=a,d.onload=d.onreadystatechange=function(){return c||this.readyState&&"complete"!==this.readyState&&"loaded"!==this.readyState?void 0:(c=!0,b?b():!0)};var f=document.getElementsByTagName("script")[0];f.parentNode.insertBefore(d,f)},handleJplayer:function(a,b){return e&&console.log("soundCloudPlayer.utils.handleJplayer"),"undefined"!=typeof jPlayer?(e&&console.log("soundCloudPlayer.utils.handleJplayer:jPlayer is already loaded"),b?b():!0):void this.loadScript(a,function(){return e&&console.log("soundCloudPlayer.utils.handleJplayer:jPlayer loaded"),b?b():!0})},buildPlaylistURL:function(a){e&&console.log("soundCloudPlayer.utils.buildPlaylistURL");var b;return b=c.replace("{username}",a.username),b=b.replace("{playlist}",a.playlist),b=b.replace("{consumerKey}",a.consumerKey),e&&console.log("soundCloudPlayer.utils.buildPlaylistURL:url builded",b),b},getTracks:function(a,c){e&&console.log("soundCloudPlayer.utils.getTracks",a);var d=this.buildPlaylistURL(a);b.ajax({dataType:"json",url:d,success:function(a){for(var b=0;b<a.tracks.length;b++)a.tracks[b].streamable||(e&&console.log('soundCloudPlayer.utils.getTracks:warning - tracks number "'+b+'", title "'+a.tracks[b].title+'" is not streamable: removed'),a.tracks.splice(b,1),a.track_count--);return 0===a.tracks.length&&e?(console.log("soundCloudPlayer.utils.getTracks:error - no track in this playlist"),c?c("no track in this playlist",null):!0):(e&&console.log("soundCloudPlayer.utils.getTracks:success"),c?c(null,a):!0)},error:function(a,b,d){return e&&console.log("soundCloudPlayer.utils.getTracks:error",b,d),c?c(d,null):!0}})},domExtend:function(){Array.prototype.random||(Array.prototype.random=function(){return this[Math.random2(0,this.length-1)]}),Math.random2||(Math.random2=function(a,b){return Math.floor(Math.random()*(b-a+1))+a})},formatSecondsAsTime:function(a){var b=Math.floor(a/3600),c=Math.floor((a-3600*b)/60),d=Math.floor(a-3600*b-60*c);return 10>c&&(c="0"+c),10>d&&(d="0"+d),c+":"+d}};return{addPlayer:h}}(a,b)});